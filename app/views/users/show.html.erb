<div class="container">
  <div class="row">


    <!-- user's avator -->
    <div class = "col-md-3 col-md-offset-0">
      <div class="user-profile-part1">
        <div class="user-profile-image">
          <% if @user.avatar? %>
            <%= link_to user_path(@user) do %>
              <%= image_tag @user.avatar, class: "img-responsive  img-rounded" %>
            <% end %>
          <% else %>
            <span class="glyphicon glyphicon-picture"></span>
          <% end %>
        </div>
        <div class="user-profile-content">
          <h3><%= @user.name %></h3>
        </div>
      </div>
    </div>


    <!-- user's introduction -->
    <div class = "col-md-9">
      <div class="user-profile-part2">
        <div class="well">
        <ul class="list-unstyled"> <!-- left margin -->
          <strong><%= @user.introduction %><br>
        </ul>
      </div>
      <% if current_user == @user %>
        <%= link_to "Edit Profile", edit_user_path(@user) , class: "btn btn-primary btn-xs" %>
      <% end %>
      </div>
    </div>
  </div>


  <!--  =========================================    -->
  <div class="row">
    <!-- 使用 Bootstrap components 的 Nav Tabs -->
    <!-- https://getbootstrap.com/docs/3.3/components/#nav-tabs -->
    <!-- if current_page?(user_path) -->
    <ul class="nav nav-tabs">
      <li role="presentation" class=<%= raw('active')  if @tab == "my_post" || !@tab  %>> <%= link_to 'My Post', user_path(tab: "my_post") %>
      </li>
      <li role="presentation" class=<%= raw('active')  if @tab == "my_comment"%>> <%= link_to 'My Comment', user_path(tab: "my_comment") %>
      </li>
      <li role="presentation" class=<%= raw('active')  if @tab == "my_collect"%>> <%= link_to 'My Collect', user_path(tab: "my_collect") %>
      </li>
      <li role="presentation" class=<%= raw('active')  if @tab == "my_draft"%>> <%= link_to 'My Draft', user_path(tab: "my_draft") %>
      </li>
      <li role="presentation" class=<%= raw('active')  if @tab == "my_friend"%>> <%= link_to 'My Friend', user_path(tab: "my_friend") %>
      </li>
    </ul>

    <% if @tab == "my_post" || !@tab  %> <!-- ============== tab ============== -->
      <table class="table table-striped table-condensed">
        <% @dojos.each do |dojo| %>
          <tr>
            <td><%= dojo.title %></td>
            <td>Published</td>
            <td><%= dojo.created_at.strftime("%F, %I:%M %p") %></td>
            <td><%= link_to 'Edit', edit_dojo_path(dojo) %></td>
            <td><%= link_to 'Destroy', dojo_path(dojo), method: :delete, data:{ confirm: "Are you sure?" } %></td>
          </tr>
        <% end %>
      </table>
    <% elsif @tab == "my_comment"%> <!-- ============== tab ============== -->
      <br>
      <div class = "col-md-12 col-md-offset-0">
        <% @comments.each do |comment| %>
          <div class="user-comment-item">
            <div class="comment-caption">
              <h3><%= comment.dojo.title %></h3>
              <% if current_user == comment.user && @edit_type == "user" && comment.id.to_s == @edit_id %>
                  <%= form_for [comment.dojo, comment] do |f| %>
                    <div class="form-group">
                      <%= f.text_area :content, placeholder: comment.content, class: "form-control" %>
                    </div>
                    <div class="form-group">
                      <%= f.submit "Update", class: "btn btn-primary btn-sm" %>
                    </div>
                  <% end %>
              <% else %>
                <p><%= truncate(comment.content, length: 320)%></p>
              <% end %>

              <!-- edit, delete -->
              <% if current_user == comment.user %>
                <% if comment.id.to_s != @edit_id %>

                  <%= link_to user_path(tab: "my_comment", edit_type: "user", edit_id: comment.id) do %>
                    <span class="glyphicon glyphicon-edit"></span>
                  <% end %>

                  <%= link_to dojo_comment_path(comment.dojo, comment.id), method: :delete, data: {confirm:"Are you sure?"} do %>
                    <span class="glyphicon glyphicon-trash"></span>
                  <% end %>
                <% end %>
              <% end %>
            </div> <!-- comment-caption -->
          </div> <!-- user-comment-item -->
        <% end %> <!-- comments.each -->
      </div> <!-- col-md -->
    <% elsif @tab == "my_collect"  %> <!-- ============== tab ============== -->
      <table class="table table-striped table-condensed">
        <% @collects.each do |collect| %>
          <tr id=collect-dojo-id-<%= collect.dojo.id %>>
            <td><h4><%= collect.dojo.title %></h4></td>
            <% if @user == current_user %>
              <td>
                <%= link_to 'Uncollect', uncollect_dojo_path(collect.dojo, page: "user"), remote: true, method: :post, class: "btn btn-info .btn-xs" %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </table>
    <% end %> <!-- tab -->
  </div>
</div>